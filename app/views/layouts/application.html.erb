<!DOCTYPE html>

<html>
  <head>
    <title><%= content_for(:title) || "Ruby On Records" %></title>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Ruby On Records">
    <meta name="mobile-web-app-capable" content="yes">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%# = tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <!-- Pico CSS CDN <link rel="stylesheet" href="css/pico.min.css"> -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
    >

    <%= stylesheet_link_tag "application" %>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css"
    >
  </head>

  <body class="pico-background-red-100">
    <nav style="background-color: #f9efdb;">
      <li>
        <%= link_to root_path, style: "display: flex; align-items: center; gap: 0.5rem; text-decoration: none;" do %>
          <%= image_tag "logo.png", alt: "Ruby On Records Logo", style: "height: 110px; width: auto;" %>
        <% end %>
      </li>
    </nav>

    <nav class="pico-background-red">
      <ul style="display: flex; align-items: left; gap: 1.0rem;">
        <li></li>

        <% if current_user.present? %>
          <li>
            <%= link_to "Catálogo", backstore_disks_path, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
          <li>
            <%= link_to "Géneros", backstore_genres_path, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
          <li>
              <%= link_to "Ventas", backstore_sales_path, method: :get, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
           <li>
               <%= link_to "Clientes", backstore_clients_path, method: :get, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
           </li>
            <% if can? :index, User %>
            <li>
                <%= link_to "Plantel", backstore_users_path, method: :get, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
            </li>
           <% end %>


        <% end %>

        <% if !current_user.present? %>
          <li>
            <%= link_to "Catálogo", disks_path, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
          <li>
            <%= link_to "Nuevos", disks_path(filter: "new"), style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
          <li>
            <%= link_to "Usados", disks_path(filter: "used"), style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
          <li>
            <%= link_to "Géneros", genres_path, style: "color: #f9efdb; font-family: monospace; font-size: 20px;" %>
          </li>
        <% end %>

        <li></li>
      </ul>

      <il style="display: flex; gap: 0.5rem;">
        <% if !current_user.present? %>
          <li>
            <%= link_to "Log-in", login_path, method: :get, style: "color: #f9efdb; font-family: monospace;" %>
          </li>
        <% else %>
          <li>
            <%= link_to "Mi perfil", backstore_user_path(current_user.id), style: "color: #f9efdb; font-family: monospace;" %>
          </li>
          <li>
            <%= link_to "Log-out", logout_path, style: "color: #f9efdb; font-family: monospace;" %>
          </li>
        <% end %>

        <li></li>
      </il>
    </nav>

    <div class="container">
      <br>
      <br>
        <% if flash[:error] %>
          <div class="alert alert-danger">
            <p style="color: #b92621;"><strong> • <%= flash[:error] %> </strong></p>
          </div>
        <% end %>

        <% if flash[:alert] %>
          <div class="alert alert-danger">
            <p style="color: #b92621;">• <%= flash[:alert] %></p>
          </div>
        <% end %>

        <% if flash[:notice] %>
          <div class="alert alert-success">
            <p style="color: #1343a0;">• <%= flash[:notice] %></p>
          </div>
        <% end %>
    </div>

    <br>
    <script>
    /*
     * Modal
     *
     * Pico.css - https://picocss.com
     * Copyright 2019-2024 - Licensed under MIT
     */

    // Config
    const isOpenClass = "modal-is-open";
    const openingClass = "modal-is-opening";
    const closingClass = "modal-is-closing";
    const scrollbarWidthCssVar = "--pico-scrollbar-width";
    const animationDuration = 400; // ms
    let visibleModal = null;

    // Toggle modal
    const toggleModal = (event) => {
      event.preventDefault();
      const modal = document.getElementById(event.currentTarget.dataset.target);
      if (!modal) return;
      modal && (modal.open ? closeModal(modal) : openModal(modal));
    };

    // Open modal
    const openModal = (modal) => {
      const { documentElement: html } = document;
      const scrollbarWidth = getScrollbarWidth();
      if (scrollbarWidth) {
        html.style.setProperty(scrollbarWidthCssVar, `${scrollbarWidth}px`);
      }
      html.classList.add(isOpenClass, openingClass);
      setTimeout(() => {
        visibleModal = modal;
        html.classList.remove(openingClass);
      }, animationDuration);
      modal.showModal();
    };

    // Close modal
    const closeModal = (modal) => {
      visibleModal = null;
      const { documentElement: html } = document;
      html.classList.add(closingClass);
      setTimeout(() => {
        html.classList.remove(closingClass, isOpenClass);
        html.style.removeProperty(scrollbarWidthCssVar);
        modal.close();
      }, animationDuration);
    };

    // Close with a click outside
    document.addEventListener("click", (event) => {
      if (visibleModal === null) return;
      const modalContent = visibleModal.querySelector("article");
      const isClickInside = modalContent.contains(event.target);
      !isClickInside && closeModal(visibleModal);
    });

    // Close with Esc key
    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape" && visibleModal) {
        closeModal(visibleModal);
      }
    });

    // Get scrollbar width
    const getScrollbarWidth = () => {
      const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
      return scrollbarWidth;
    };

    // Is scrollbar visible
    const isScrollbarVisible = () => {
      return document.body.scrollHeight > screen.height;
    };
</script>

    <!--
  ./ Modal example
  <section id="modal">
  <h2>Modal</h2>
  <button
  class="contrast"
  data-target="modal-example"
  onclick="toggleModal(event)"
  >
  Launch demo modal
  </button>
  </section>
-->

    <!-- Modal example -->
    <dialog id="modal-example">
      <article>
        <header>
          <button
            aria-label="Close"
            rel="prev"
            data-target="modal-example"
            onclick="toggleModal(event)"
          ></button>

          <h3>Confirm your action!</h3>
        </header>
        "created_at DESC"
        <p>
          Cras sit amet maximus risus. Pellentesque sodales odio sit amet augue
          finibus pellentesque. Nullam finibus risus non semper euismod.
        </p>

        <footer>
          <button
            role="button"
            class="secondary"
            data-target="modal-example"
            onclick="toggleModal(event)"
          >
            Cancel
          </button>

          <button
            autofocus
            data-target="modal-example"
            onclick="toggleModal(event)"
          >
            Confirm
          </button>
        </footer>
      </article>
    </dialog>

    <!-- ./ Modal example -->

    <%= yield %>
  </body>

  <footer>
    <p></p>
  </footer>
</html>
